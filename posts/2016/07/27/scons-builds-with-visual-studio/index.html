<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>SCons builds with Visual Studio - The Grbd Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://grbd.github.io/posts/2016/07/27/scons-builds-with-visual-studio/">

        <meta name="author" content="Grbd" />
        <meta name="keywords" content="code,SCons,build" />
        <meta name="description" content="SCons builds with Visual Studio" />

        <meta property="og:site_name" content="The Grbd Blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="SCons builds with Visual Studio"/>
        <meta property="og:url" content="http://grbd.github.io/posts/2016/07/27/scons-builds-with-visual-studio/"/>
        <meta property="og:description" content="SCons builds with Visual Studio"/>
        <meta property="article:published_time" content="2016-07-27" />
            <meta property="article:section" content="code" />
            <meta property="article:tag" content="code" />
            <meta property="article:tag" content="SCons" />
            <meta property="article:tag" content="build" />
            <meta property="article:author" content="Grbd" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://grbd.github.io/theme/css/bootstrap.cyborg.min.css" type="text/css"/>
    <link href="http://grbd.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://grbd.github.io/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://grbd.github.io/theme/css/style.css" type="text/css"/>

        <link href="http://grbd.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="The Grbd Blog ATOM Feed"/>



        <link href="http://grbd.github.io/feeds/code.atom.xml" type="application/atom+xml" rel="alternate"
              title="The Grbd Blog code ATOM Feed"/>

    <link href="http://grbd.github.io/theme/css/bootstrap-custom.min.css" rel="stylesheet">

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://grbd.github.io/" class="navbar-brand">
The Grbd Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="http://grbd.github.io/category/code.html">Code</a>
                        </li>
                        <li >
                            <a href="http://grbd.github.io/category/micro.html">Micro</a>
                        </li>
                        <li >
                            <a href="http://grbd.github.io/category/personal.html">Personal</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<style>
	#banner{
	    background-image:url("http://grbd.github.io/images/backdrops/backdrop1.jpg");
	}
</style>

<div id="banner">
	<div class="container">
		<div class="copy">
			<h1>The Grbd Blog</h1>
		</div>
	</div>
</div><!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://grbd.github.io/posts/2016/07/27/scons-builds-with-visual-studio/"
                       rel="bookmark"
                       title="Permalink to SCons builds with Visual Studio">
                        SCons builds with Visual Studio
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-07-27T18:53:00+01:00"> Wed 27 July 2016</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://grbd.github.io/tag/code.html">code</a>
        /
	<a href="http://grbd.github.io/tag/scons.html">SCons</a>
        /
	<a href="http://grbd.github.io/tag/build.html">build</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h2>Overview</h2>
<p>For a while now I've been looking for a decent build system with a language I can easily write and debug.</p>
<p>During the very old days of Linux the main go to for a build system typically was <em>make</em> and <em>configure</em>.
Configure would check the system to see if a library was present and its location,
Make would use Makefile scripts to handle the actual compilation based on the results from configure.
Surrounding these two was autotools which included autoconf and automake to try and make writing these sorts of scripts a lot easier.
However, over time because of cross compatibility reasons, if you were new to this sort of thing, it could quite quickly become a rat's nest of code.</p>
<p>Then came along CMake, CMake is a meta language in that it generates Make files in a similar fashion to autoconf and automake but all rolled into one
with an easier to use language and syntax.
CMake has now taken over as one of the more popular build systems since it's also windows and cross platform compatible.</p>
<p>However personally I've never been that fond of CMake</p>
<ul>
<li>It has no fixed API for hooking into, forcing you to use the CMake language</li>
<li>The CMake language while very cross platform lacks features (such as class's for example)</li>
<li>You can't step through the code / build script with a debugger (I could be wrong on this one, but I've not found one)</li>
</ul>
<p>I should point out there does appear to be an upcoming feature called server mode that may allow for some form of API access in the future</p>
<h2>SCons / Cuppa</h2>
<p>This is where SCons and Cuppa comes in.</p>
<p>I've placed an example over on my GitHub account <a href="https://github.com/grbd/GBD.Blog.Examples/tree/master/Source/SconsBuild">https://github.com/grbd/GBD.Blog.Examples/tree/master/Source/SconsBuild</a></p>
<p>In the past I've dabbled in a large number of different languages.
Currently my two favourites are .Net and python, the reason being they're debuggable via Visual Studio.
I've found that python makes for a very good scripting language, you can also easily debug it, add break points, get auto completion features etc.
In the open source world pycharm is one of the favourites for debugging python code this offers a lot of similar features.
My personal favourite though is the latest Visual Studio 2015 with python tools.
With VS Python tools we can get all the good auto completion features and can debug / step code to our hearts content.</p>
<p>SCons is a python based build system, unlike CMake it doesn't generate make files in that it handles the build itself.
One of the main benefits of python is that it has a vast library of supporting code.
To give an example if I'm planning on writing a VC++ Visual Studio project but want to make it cross platform.
One approach might be to write the code using a VS project file, but for the build process read in the xml using python / SCons, then parse it to generate the build via SCons.
Or I could do it the other way around and have a VS Project file generated from a simple python block of code that lists all the source files.
python gives us a great deal of power to do interesting things not normally possible in other build systems.</p>
<h3>Cuppa</h3>
<p>Cuppa is an extension to SCons in that is possess some features that allow easier building of VC++ projects.
I haven't gotten around to exploring Cuppa just yet, but to install it under windows.</p>
<p>First you'll need to install lxml, this doesn't seem to be installable via pip directly under windows.
But we can get a pre-packaged whl file from this site <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml">http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml</a></p>
<p>In my case since I'm using python 2.7 64bit, so I downloaded the <em>lxml-3.6.1-cp27-cp27m-win_amd64.whl</em> file. <br>
After downloading it should just be a case of using pip from a command prompt to install the lxml package.</p>
<div class="highlight"><pre><span></span>pip install lxml-3.6.1-cp27-cp27m-win_amd64.whl
</pre></div>


<p>Next we can install cuppa using pip</p>
<div class="highlight"><pre><span></span>pip install cuppa
</pre></div>


<p>I've included some links below for some more information. <br>
The below example does not use Cuppa, as I'm just focusing on debugging the build script with Visual Studio for the below.</p>
<ul>
<li><a href="https://github.com/ja11sop/cuppa">https://github.com/ja11sop/cuppa</a></li>
<li><a href="https://www.youtube.com/watch?v=h_HhBT6xGeE">https://www.youtube.com/watch?v=h_HhBT6xGeE</a></li>
</ul>
<h2>Code Example</h2>
<p>In the below example I'm going to show how I managed to debug a SCons python file (SConstruct) within Visual Studio using Python Tools</p>
<h3>hello1.c</h3>
<p>First let's create a very simple hello world program called <strong>hello1.c</strong></p>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, world!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h3>SConstruct files</h3>
<p>Visual Studio recognises python files based on the extension of .py
The SConstruct python script files that SCons looks for lacks this extension which creates a problem.
One way around this is to use two files</p>
<p><strong>SConstruct</strong></p>
<div class="highlight"><pre><span></span><span class="nb">execfile</span><span class="p">(</span><span class="s1">&#39;SConstruct.py&#39;</span><span class="p">)</span>
</pre></div>


<p><strong>SConstruct.py</strong></p>
<div class="highlight"><pre><span></span><span class="ch">#!python</span>

<span class="c1"># These import lines are not really needed, but it helps intellisense within VS when editing the script</span>
<span class="kn">import</span> <span class="nn">SCons.Script</span>
<span class="kn">from</span> <span class="nn">SCons.Environment</span> <span class="kn">import</span> <span class="n">Environment</span>

<span class="c1"># For a more detailed / cross platform build script see</span>
<span class="c1"># https://bitbucket.org/scons/scons/wiki/AllInSConstruct</span>

<span class="k">print</span> <span class="s2">&quot;Building Hello1.c&quot;</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">()</span>

<span class="c1"># Add the Debug Flags if debug=1 is specified on the command line, this tends to be compiler specific</span>
<span class="k">if</span> <span class="n">ARGUMENTS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">env</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">CPPDEFINES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s1">&#39;_DEBUG&#39;</span><span class="p">])</span>
    <span class="n">env</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">CCFLAGS</span><span class="o">=</span><span class="s1">&#39;/MDd&#39;</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">CCFLAGS</span><span class="o">=</span><span class="n">Split</span><span class="p">(</span><span class="s1">&#39;/Zi /Fd${TARGET}.pdb&#39;</span><span class="p">))</span>
    <span class="n">env</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">LINKFLAGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/DEBUG&#39;</span><span class="p">])</span>
    <span class="n">variant</span> <span class="o">=</span> <span class="s1">&#39;Debug&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">env</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">CPPDEFINES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NDEBUG&#39;</span><span class="p">])</span>
    <span class="n">variant</span> <span class="o">=</span> <span class="s1">&#39;Release&#39;</span>

<span class="k">print</span> <span class="s2">&quot;Building: &quot;</span> <span class="o">+</span> <span class="n">variant</span>

<span class="c1"># Create a hello1.exe from the c file</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">Program</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s1">&#39;src/hello1&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;src/hello1.c&#39;</span><span class="p">])</span>
<span class="n">Default</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>


<p>The first file SConstruct is read in by the SCons tool initially, this just has a single line of code which basically says read in and process SConstruct.py.
The SConstruct.py file is where all of our build logic is stored, this is the file we'll be editing and using within Visual Studio</p>
<p>Note that SCons automatically imports SCons.Script before running the script, I've included it anyway just to help out with VS Intellisense</p>
<h2>Setting up the Visual Studio files for the Build</h2>
<p>Next we're going to setup a VS Solution and Project file to debug the build script</p>
<ul>
<li>Create a sub directory of <strong>vs</strong></li>
<li>Create a new Solution, call it something like <strong>BuildSolution</strong></li>
<li>Create a new Python Application project, call it something like <strong>SConsBuild</strong></li>
<li>Right click on the project, and select Project Properties</li>
</ul>
<h3>General Tab</h3>
<p>Next we're going to set a couple of options under the <strong>General Tab</strong></p>
<ul>
<li>Set the start-up script to <strong>C:\Python27\Scripts\scons.py</strong>, this path may be different based on your python install.<br>
    Visual Studio needs to use absolute paths for this option.</li>
<li>Set the working directory to the location of the SConstruct file / root of the source project, this can be a relative path such as <strong>..\..</strong> <br>
    The path should be relative to the location of the project file.</li>
<li>Make sure to set the python interpreter to Python2, such as <strong>Python 64-bit 2.7</strong> <br>
    SCons does not yet support python3</li>
</ul>
<p><img alt="GeneralProps1" src="http://grbd.github.io/static/code/scons.1.vsdebug/GeneralProps1.png"></p>
<h3>Debug Tab</h3>
<p>Next looking at the <strong>Debug Tab</strong></p>
<ul>
<li>Set the search paths ..\..\;C:\Python27\Lib\site-packages\scons-2.5.0</li>
</ul>
<p>The search path needs to include the relative path to where the SConstruct file is located.
Also it needs to include the directory for the SCons installation, I found this is needed to get Intellisense working with the script.
It looks as if SCons has deliberately put the library files within a SCons subdirectory in the site-packages install directory for python.
I suspect this has been done to avoid users from calling the SCons library directly without first going via the main scons.py script.</p>
<p><img alt="DebugProps1" src="http://grbd.github.io/static/code/scons.1.vsdebug/DebugProps1.png"></p>
<h3>Build file link</h3>
<p>Finally, we just need to add in the <strong>SConsBuild.py</strong> file as a Link to the project.
By adding it as a link we avoid creating a 2nd copy under the VS Project directory, and when we edit the file we'll be editing the one in the original location.</p>
<p><img alt="AddLink1" src="http://grbd.github.io/static/code/scons.1.vsdebug/AddLink1.png"></p>
<h3>Note about Intellisense</h3>
<p>Just a quick note, sometimes after creating a new project, you need to right click unload, then re-load the project within Visual Studio to get the Intellisense working correctly</p>
<h2>Setting up the Visual Studio files for the hello code</h2>
<p>For the <strong>hello1.c</strong> file within the blog example code I also setup a Visual Studio Project.
This allowed me to edit the code from within Visual Studio and trigger the build process from there as well.</p>
<p>In order to do this, you're going to want to use a <em>Makefile</em> style Visual Studio Project. These types of projects allow for custom build tools to be specified instead of using the inbuilt MS build tools. In this case we're going to set it to use the SCons tool to handle the building and cleaning of the project.</p>
<p>After creating one of these types of Project, if you open up the project properties you'll notice the Configuration Type is listed as <em>Makefile</em></p>
<p><img alt="Hello1_General" src="http://grbd.github.io/static/code/scons.1.vsdebug/Hello1_General.png"></p>
<p>The import part that we need to alter is located under the NMake tab.
The debug=1 is just an option we can pass to the SCons script to indicate if it's a Release or Debug Build</p>
<ul>
<li><strong>Build: scons -C ..\.. debug=1</strong></li>
<li><strong>Rebuild All: scons -C ..\.. -c &amp;&amp; scons -C ..\.. debug=1</strong></li>
<li><strong>Clean: scons -C ..\.. -c</strong></li>
<li><strong>Destination exe: ..\..\src\hello1.exe</strong></li>
</ul>
<p><img alt="Hello1_NMake" src="http://grbd.github.io/static/code/scons.1.vsdebug/Hello1_NMake.png"></p>
<h2>Debugging the build script</h2>
<p>I've not really covered any of the details on using the SCons API at this stage simply because I'm still learning it myself.
But if everything has been setup correctly we should now be able to run / debug the SCons build script within Visual Studio.
For a script as simple as this one it's probably not worth the time and effort to set something like this up, but for a much more complex project
finding problems and issues with the build scripts can be a made a lot easier when you can single step the code within the build script itself.</p>
<p>This is really more of a convenience than anything else, you can still edit the build scripts independently of Visual Studio,
and it's likely you could setup something very similar using pycharm (the free open source equivalent to VS Python Tools).
But for me at least this should make life a lot easier for cross platform or even cross compiling complex builds.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="http://grbd.github.io/pages/profile/aboutme.html"><i class="fa fa-about-me-square fa-lg"></i> About Me</a></li>
                <li class="list-group-item"><a href="https://github.com/grbd"><i class="fa fa-github-personal-square fa-lg"></i> Github Personal</a></li>
                <li class="list-group-item"><a href="https://github.com/ASoftTech"><i class="fa fa-github-company-square fa-lg"></i> Github Company</a></li>
                <li class="list-group-item"><a href="http://grbd.github.io/pages/profile/projects.html"><i class="fa fa-projects-square fa-lg"></i> Projects</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="https://hacman.org.uk/" target="_blank">
                Manchester Hacspace
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Grbd
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://grbd.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://grbd.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://grbd.github.io/theme/js/respond.min.js"></script>

    <script src="http://grbd.github.io/theme/js/bodypadding.js"></script>

</body>
</html>