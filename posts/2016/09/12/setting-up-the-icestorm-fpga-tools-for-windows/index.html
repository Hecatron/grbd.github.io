<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Setting up the IceStorm FPGA tools for Windows - The Grbd Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://grbd.github.io/posts/2016/09/12/setting-up-the-icestorm-fpga-tools-for-windows/">

        <meta name="author" content="Grbd" />
        <meta name="keywords" content="code,fpga,icestorm" />
        <meta name="description" content="Setting up the IceStorm FPGA tools for Windows" />

        <meta property="og:site_name" content="The Grbd Blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Setting up the IceStorm FPGA tools for Windows"/>
        <meta property="og:url" content="http://grbd.github.io/posts/2016/09/12/setting-up-the-icestorm-fpga-tools-for-windows/"/>
        <meta property="og:description" content="Setting up the IceStorm FPGA tools for Windows"/>
        <meta property="article:published_time" content="2016-09-12" />
            <meta property="article:section" content="code" />
            <meta property="article:tag" content="code" />
            <meta property="article:tag" content="fpga" />
            <meta property="article:tag" content="icestorm" />
            <meta property="article:author" content="Grbd" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://grbd.github.io/theme/css/bootstrap.cyborg.min.css" type="text/css"/>
    <link href="http://grbd.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://grbd.github.io/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://grbd.github.io/theme/css/style.css" type="text/css"/>

        <link href="http://grbd.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="The Grbd Blog ATOM Feed"/>



        <link href="http://grbd.github.io/feeds/code.atom.xml" type="application/atom+xml" rel="alternate"
              title="The Grbd Blog code ATOM Feed"/>

    <link href="http://grbd.github.io/theme/css/bootstrap-custom.min.css" rel="stylesheet">

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://grbd.github.io/" class="navbar-brand">
The Grbd Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="http://grbd.github.io/category/code.html">Code</a>
                        </li>
                        <li >
                            <a href="http://grbd.github.io/category/personal.html">Personal</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<style>
	#banner{
	    background-image:url("http://grbd.github.io/images/backdrops/backdrop1.jpg");
	}
</style>

<div id="banner">
	<div class="container">
		<div class="copy">
			<h1>The Grbd Blog</h1>
		</div>
	</div>
</div><!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://grbd.github.io/posts/2016/09/12/setting-up-the-icestorm-fpga-tools-for-windows/"
                       rel="bookmark"
                       title="Permalink to Setting up the IceStorm FPGA tools for Windows">
                        Setting up the IceStorm FPGA tools for Windows
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-09-12T21:30:00+01:00"> Mon 12 September 2016</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="http://grbd.github.io/tag/code.html">code</a>
        /
	<a href="http://grbd.github.io/tag/fpga.html">fpga</a>
        /
	<a href="http://grbd.github.io/tag/icestorm.html">icestorm</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h2>Overview</h2>
<p>There was recently a presentation by the team running the icestorm project over at the Manchester Hackspace. <br>
Icestorm is a project that provides a fpga board for under $30 (about 25 Pounds in British money) </p>
<ul>
<li><a href="https://hackaday.com/2016/08/03/the-perfect-storm-open-arm-fpga-board/">https://hackaday.com/2016/08/03/the-perfect-storm-open-arm-fpga-board/</a></li>
<li><a href="http://www.clifford.at/icestorm/">http://www.clifford.at/icestorm/</a></li>
<li><a href="http://www.clifford.at/yosys/">http://www.clifford.at/yosys/</a></li>
</ul>
<p>Typically, the two largest vendors of fpga's tend to be Altera and Zynq.
However, both of these vendors require closed source tools which tend to be very large to compile down from Verilog or VHDL
into code that can be used on the FPGA.</p>
<p>With this board a <strong><a href="http://www.farnell.com/datasheets/1673535.pdf">iCE40HX4K</a></strong> from Lattice Semiconductor is used instead. <br>
The team behind this project have built up a full open source toolchain for it.</p>
<p>I don't have a board yet (I'm thinking of building a modified one)
But I decided to see if I could build out the initial tools needed to compile Verilog.
With the eventual plan to use <a href="http://www.myhdl.org/">Myhdl</a> which would compile down to ether Verilog / VHDL for use on the board</p>
<h2>Installation</h2>
<h3>MSYS2</h3>
<p>First for windows you'll need a copy of MSYS2 installed if you haven't already got it</p>
<ul>
<li><a href="https://msys2.github.io/">https://msys2.github.io/</a></li>
</ul>
<p>Once it's installed you can update the package database / packages via</p>
<div class="highlight"><pre><span></span>pacman -Syuu
</pre></div>


<p>There are 3 shells available in total</p>
<ul>
<li>MSYS2</li>
<li>MinGW 32Bit</li>
<li>MinGW 64bit</li>
</ul>
<p>For building some of the below sources I use MSYS2 and for others I use MinGW.
Strictly speaking the only real difference is the C library that they link against.
Based on this Link <a href="https://sourceforge.net/p/msys2/discussion/general/thread/dcf8f4d3/">https://sourceforge.net/p/msys2/discussion/general/thread/dcf8f4d3/</a></p>
<p>MSYS2 Better understands POSIX conventions like paths, it does have a performance penalty compared to MinGW
since it funnels everything via msys-2.0.dll. But it can work sometimes better than MinGW when trying to compile Linux apps under Windows.</p>
<p>MinGW does not depend on msys-2.0.dll and instead uses the MSVC runtime. <br>
For the below I'm only really interested it getting things to work, so I've just used whichever one works best for each source package.</p>
<h3>MSYS2 - Depends</h3>
<p>Next we need to install some dependencies, open up a MSYS2 shell and install the following</p>
<div class="highlight"><pre><span></span>pacman -S mingw64/mingw-w64-x86_64-clang
pacman -S msys/bison
pacman -S msys/flex
pacman -S msys/libreadline-devel
pacman -S msys/gawk
pacman -S msys/tcl
pacman -S msys/libffi-devel
pacman -S git
pacman -S cmake
pacman -S mercurial
pacman -S msys/pkg-config
pacman -S python
pacman -S python3
pacman -S mingw64/mingw-w64-x86_64-libftdi
pacman -S mingw64/mingw-w64-x86_64-python3-pip
pacman -S mingw64/mingw-w64-x86_64-python2-pip
pacman -S mingw64/mingw-w64-x86_64-dlfcn
</pre></div>


<h3>Xdot - Python</h3>
<p>Let's install xdot next, there currently isn't a pacman package for it, so I've used python / pip since it's a python based library <br>
Within a <strong>MinGW x64</strong> window</p>
<div class="highlight"><pre><span></span>pip2 install xdot
pip3 install xdot
</pre></div>


<h3>Icestorm Tools</h3>
<p>Next let's build and install icestorm
I've found this doesn't work under MSYS2, but does work under <strong>MinGW x64</strong></p>
<div class="highlight"><pre><span></span>git clone https://github.com/cliffordwolf/icestorm.git icestorm
cd icestorm
make PREFIX=/usr -j$(nproc)
make PREFIX=/usr install
cd ..
</pre></div>


<p>This should install the icebox tools to /usr/bin/</p>
<h3>Arachne-pnr (The place and route tool)</h3>
<p>Next let's build and install Arachne-pnr for the place and route tools <br>
I'm running this build within a MinGW x64 window as above</p>
<div class="highlight"><pre><span></span>git clone https://github.com/cseed/arachne-pnr.git arachne-pnr
cd arachne-pnr
make DESTDIR=/usr ICEBOX=/usr/share/icebox -j$(nproc)
make DESTDIR=/usr ICEBOX=/usr/share/icebox install
cd ..
</pre></div>


<p>This should install arachne-pnr to /usr/bin/</p>
<h3>Yosys (Verilog synthesis)</h3>
<p>For Yosys there is the pre-compiled version 0.6 available here</p>
<ul>
<li><a href="http://www.clifford.at/yosys/download.html">http://www.clifford.at/yosys/download.html</a></li>
</ul>
<p>Although I think ideally we need the latest version from git for the iCE FPGA's <br>
From what I've discovered trying to build this under the MinGW console will not work. <br>
However, building under the MSYS2 Console does work, with a little tweaking of the Makefile.</p>
<p>First let's download a copy of yosys</p>
<div class="highlight"><pre><span></span>git clone https://github.com/cliffordwolf/yosys.git yosys
<span class="nb">cd</span> yosys
</pre></div>


<p>Next we're going to configure make for MSYS2</p>
<div class="highlight"><pre><span></span>make config-msys2
</pre></div>


<p>Next we need to patch the Makefile</p>
<div class="highlight"><pre><span></span>wget http://grbd.github.io/static/code/fpga.icestorm.1/yosys-winpatch1.patch
patch -p1 &lt; yosys-winpatch1.patch
</pre></div>


<p>Next we can start the build</p>
<div class="highlight"><pre><span></span>make <span class="nv">PREFIX</span><span class="o">=</span>/usr
</pre></div>


<p>Finally, we can install the files into /usr/</p>
<div class="highlight"><pre><span></span>make <span class="nv">PREFIX</span><span class="o">=</span>/usr install
</pre></div>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="http://grbd.github.io/pages/profile/aboutme.html"><i class="fa fa-about-me-square fa-lg"></i> About Me</a></li>
                <li class="list-group-item"><a href="https://github.com/grbd"><i class="fa fa-github-personal-square fa-lg"></i> Github Personal</a></li>
                <li class="list-group-item"><a href="https://github.com/ASoftTech"><i class="fa fa-github-company-square fa-lg"></i> Github Company</a></li>
                <li class="list-group-item"><a href="http://grbd.github.io/pages/profile/projects.html"><i class="fa fa-projects-square fa-lg"></i> Projects</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="https://hacman.org.uk/" target="_blank">
                Manchester Hacspace
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Grbd
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://grbd.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://grbd.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://grbd.github.io/theme/js/respond.min.js"></script>

    <script src="http://grbd.github.io/theme/js/bodypadding.js"></script>

</body>
</html>